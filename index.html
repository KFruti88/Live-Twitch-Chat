<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <title>Werewolf Chat Relay Overlay</title>
    
    <style>
        @import url(https://fonts.googleapis.com/css?family=Roboto:700);
        * { box-sizing: border-box; }
        html, body { height: 100%; overflow: hidden; background: #1a1a1b; } /* Changed to dark background for visibility on GitHub */
        body {
            text-shadow: 0 0 1px #000, 0 0 2px #000;
            font-family: 'Roboto', sans-serif;
            font-weight: 700;
            font-size: 24px;
            line-height: 1.5em;
            color: #ffffff;
        }
        #log {
            display: table;
            position: absolute;
            bottom: 0;
            left: 0;
            padding: 0 10px 10px;
            width: 90%; /* Standard 90% width */
            table-layout: fixed;
        }
        #log > div {
            display: table-row;
            animation: fadeInRight .3s ease forwards, fadeOut 0.5s ease 15s forwards;
        }
        #log .message, #log .meta {
            vertical-align: top;
            display: table-cell;
            padding-bottom: 0.1em;
        }
        #log .meta {
            width: 35%;
            text-align: right;
            padding-right: 0.5em;
            white-space: nowrap;
            text-overflow: ellipsis;
            overflow: hidden;
        }
        #log .message { word-wrap: break-word; width: 65%; }
        
        @keyframes fadeInRight { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
    </style>
</head>
<body>

<div id="log" class="sl__chat__layout"></div>

<script type="text/template" id="chatlist_item">
    <div data-from="{from}">
        <span class="meta" style="color: {color}">
            <span class="name">{from}</span>
        </span>
        <span class="message">{message}</span>
    </div>
</script>

<script src="https://cdn.jsdelivr.net/npm/comfy.js@latest/dist/comfy.min.js"></script>

<script>
    const CHAT_CHANNEL = "werewolf3788";

    // Initialize ComfyJS
    // NOTE: When viewing via GitHub URL, this is Read-Only unless you provide a token in the URL
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token'); 

    ComfyJS.onChat = (user, message, flags, self, extra) => {
        if (self) return; 

        const log = document.getElementById('log');
        const template = document.getElementById('chatlist_item').innerHTML;

        let html = template
            .replace(/{from}/g, user)
            .replace(/{color}/g, extra.userColor || "#fe4f00")
            .replace(/{message}/g, message);

        const div = document.createElement('div');
        div.innerHTML = html;
        log.appendChild(div.firstElementChild);

        // Keep only last 10 messages for performance
        if (log.children.length > 10) {
            log.removeChild(log.firstChild);
        }
    };

    // If no token is provided, it connects in Read-Only mode (perfect for viewing)
    ComfyJS.Init(CHAT_CHANNEL, token);
    console.log(`ðŸ“¡ Monitoring Twitch Chat for: ${CHAT_CHANNEL}`);
</script>
</body>
</html>
