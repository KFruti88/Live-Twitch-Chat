name: Werewolf All-In-One Relay
on:
  push:
    branches: [ main ]
  schedule:
    - cron: '0 */4 * * *'
  workflow_dispatch:

jobs:
  run-relays:
    runs-on: ubuntu-latest
    concurrency: 
      group: relay-group
      cancel-in-progress: true
    steps:
      - uses: actions/checkout@v3
      - name: Install Node & Tools
        run: npm install tmi.js socket.io-client puppeteer
      - name: Start All Relays
        env:
          STREAMLABS_TOKEN: ${{ secrets.STREAMLABS_TOKEN }}
          TWITCH_ACCESS_TOKEN: ${{ secrets.TWITCH_ACCESS_TOKEN }}
        # Runs both scripts in the background
        run: |
          node relay.js & 
          node rumble-relay.js &
          wait -n
